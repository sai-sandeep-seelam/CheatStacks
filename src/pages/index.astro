---
import Layout from '../layouts/Layout.astro';
import { getAllCheatsheets } from '../utils/cheatsheets';
import { siteConfig } from '../config/site';

const cheatsheets = getAllCheatsheets();

// Group by category
const categories = cheatsheets.reduce((acc, sheet) => {
    const cat = sheet.meta.category || 'Other';
    if (!acc[cat]) acc[cat] = [];
    acc[cat].push(sheet);
    return acc;
}, {} as Record<string, typeof cheatsheets>);

const sortedCategories = Object.keys(categories).sort();
---

<Layout title={siteConfig.title}>
  <!-- Hero Section with Gradient Background -->
  <div class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-indigo-50 via-white to-cyan-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 opacity-50"></div>
    <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5"></div>

    <div class="relative max-w-3xl mx-auto text-center mb-16 animate-fade-in">
      <h1 class="text-4xl font-extrabold tracking-tight text-slate-900 dark:text-white sm:text-5xl mb-6 font-inter">
        The Ultimate <span class="bg-gradient-to-r from-indigo-600 via-purple-600 to-cyan-600 bg-clip-text text-transparent animate-gradient">Developer</span> Cheatsheets
      </h1>
      <p class="text-xl text-slate-600 dark:text-slate-400 leading-relaxed font-inter animate-slide-up">
        A fast, modern, and open-source collection of cheatsheets.
        <br class="hidden sm:inline" />
        Powered by the community and built for performance.
      </p>
    </div>
  </div>

  <!-- Bookmarks Section -->
  <div id="bookmarks-section" class="max-w-4xl mx-auto mb-16 hidden animate-slide-up">
    <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-6 flex items-center gap-2 font-inter">
      <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
      </svg>
      Your Bookmarks
    </h2>
    <div id="bookmarks-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Bookmarks will be loaded here -->
    </div>
    <div class="mt-4 text-center">
      <a href="/bookmarks" class="text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 text-sm font-medium transition-colors duration-200 hover:underline">View all bookmarks â†’</a>
    </div>
  </div>

  <!-- Categories Grid with Enhanced Styling -->
  <div class="grid gap-8 animate-fade-in" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
    {sortedCategories.map((category, index) => (
      <div class={`h-96 bg-gradient-to-br from-white to-slate-50 dark:from-slate-800/80 dark:to-slate-700/80 border border-slate-200/50 dark:border-slate-700/50 rounded-xl p-6 flex flex-col break-inside-avoid backdrop-blur-sm hover:shadow-xl hover:shadow-indigo-500/10 transition-all duration-500 hover:scale-[1.02] hover:-translate-y-1 animate-slide-up stagger-${index % 3} glass`}>
        <h2 class="text-lg font-bold text-slate-900 dark:text-white border-b border-slate-200/50 dark:border-slate-700/50 pb-3 mb-4 flex items-center flex-shrink-0 font-inter">
          <span class="bg-gradient-to-r from-indigo-600 to-cyan-600 bg-clip-text text-transparent">{category}</span>
          <span class="ml-auto text-xs font-normal text-slate-500 dark:text-slate-400 bg-gradient-to-r from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 px-3 py-1 rounded-full border border-slate-200/50 dark:border-slate-600/50">{categories[category].length}</span>
        </h2>
        <ul class="space-y-1 overflow-y-auto overflow-x-hidden flex-1 custom-scrollbar">
          {categories[category].map((sheet, itemIndex) => (
            <li class={`animate-slide-in-right stagger-item-${itemIndex % 5}`}>
              <a href={`/cheatsheets/${sheet.slug}`} class="group flex items-center justify-between px-4 py-3 -mx-4 rounded-lg hover:bg-gradient-to-r hover:from-indigo-50/50 hover:to-cyan-50/50 dark:hover:from-slate-700/50 dark:hover:to-slate-600/50 transition-all duration-300 hover:scale-[1.01] border border-transparent hover:border-indigo-200/30 dark:hover:border-slate-600/30 font-inter">
                <span class="text-slate-600 dark:text-slate-400 font-medium group-hover:text-indigo-600 dark:group-hover:text-cyan-400 transition-colors duration-300 truncate pr-4">{sheet.meta.title}</span>
                <svg class="w-4 h-4 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-cyan-400 transition-all duration-300 opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </div>
</Layout>

<script>
  function loadBookmarks() {
    // Only show bookmarks to logged-in users
    const loggedIn = localStorage.getItem('loggedIn');
    const bookmarks = JSON.parse(localStorage.getItem('cheatstack-bookmarks') || '[]');
    const bookmarksSection = document.getElementById('bookmarks-section');
    const bookmarksGrid = document.getElementById('bookmarks-grid');

    // If not logged in, ensure section stays hidden and don't render bookmarks
    if (loggedIn !== 'true') {
      if (bookmarksSection) bookmarksSection.classList.add('hidden');
      if (bookmarksGrid) bookmarksGrid.innerHTML = '';
      return;
    }

    // Clear existing
    if (bookmarksGrid) bookmarksGrid.innerHTML = '';

    if (bookmarks.length > 0) {
      if (bookmarksSection) bookmarksSection.classList.remove('hidden');

      // Show up to 6 bookmarks
      const displayBookmarks = bookmarks.slice(0, 6);

      displayBookmarks.forEach((bookmark) => {
        const card = document.createElement('a');
        card.href = `/cheatsheets/${bookmark.slug}`;
        card.className = 'bg-white dark:bg-slate-800 rounded-lg shadow p-4 border border-slate-200 dark:border-slate-700 hover:shadow-lg transition-shadow block';
        card.innerHTML = `
          <h3 class="text-sm font-semibold text-slate-900 dark:text-white">${bookmark.title}</h3>
          ${bookmark.category ? `<p class="text-xs text-slate-500 dark:text-slate-400 mt-1">${bookmark.category}</p>` : ''}
        `;
        if (bookmarksGrid) bookmarksGrid.appendChild(card);
      });
    } else {
      if (bookmarksSection) bookmarksSection.classList.add('hidden');
    }
  }

  document.addEventListener('DOMContentLoaded', loadBookmarks);
  window.addEventListener('bookmarks-updated', loadBookmarks);
</script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

  .font-inter {
    font-family: 'Inter', 'system-ui', '-apple-system', sans-serif;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes gradient {
    0%, 100% {
      background-size: 200% 200%;
      background-position: left center;
    }
    50% {
      background-size: 200% 200%;
      background-position: right center;
    }
  }

  .animate-fade-in {
    animation: fadeIn 1s ease-out;
  }

  .animate-slide-up {
    animation: slideUp 0.8s ease-out forwards;
    opacity: 0;
  }

  .animate-slide-in-right {
    animation: slideInRight 0.6s ease-out forwards;
    opacity: 0;
  }

  .animate-gradient {
    animation: gradient 3s ease infinite;
    background-size: 200% 200%;
  }

  /* Stagger delays */
  .stagger-0 { animation-delay: 0.1s; }
  .stagger-1 { animation-delay: 0.3s; }
  .stagger-2 { animation-delay: 0.5s; }

  .stagger-item-0 { animation-delay: 0.1s; }
  .stagger-item-1 { animation-delay: 0.15s; }
  .stagger-item-2 { animation-delay: 0.2s; }
  .stagger-item-3 { animation-delay: 0.25s; }
  .stagger-item-4 { animation-delay: 0.3s; }

  /* Custom scrollbar */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(99, 102, 241, 0.3) transparent;
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(99, 102, 241, 0.6), rgba(6, 182, 212, 0.6));
    border-radius: 3px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, rgba(99, 102, 241, 0.8), rgba(6, 182, 212, 0.8));
  }

  /* Glass morphism effect */
  .glass {
    backdrop-filter: blur(16px) saturate(180%);
    background-color: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(209, 213, 219, 0.3);
  }

  .dark .glass {
    background-color: rgba(30, 41, 59, 0.85);
    border: 1px solid rgba(71, 85, 105, 0.3);
  }

  /* Enhanced hover effects */
  .category-card:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .dark .category-card:hover {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
  }
</style>
